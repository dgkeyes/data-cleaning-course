<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Common Issues in Data Cleaning</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <link href="libs/tachyons/tachyons.min.css" rel="stylesheet" />
    <link href="libs/xaringanExtra-extra-styles/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <link href="libs/animate.css-xaringan/animate.fade.css" rel="stylesheet" />
    <link rel="stylesheet" href="style.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Common Issues in Data Cleaning

---





layout: true
  
&lt;div class="dk-footer"&gt;
&lt;span&gt;
&lt;a href="https://rfortherestofus.com/" target="_blank"&gt;R for the Rest of Us
&lt;/a&gt;
&lt;/span&gt;
&lt;/div&gt; 

---
















class: center, middle, dk-section-title
background-image:url("images/michael-We2t3suGiYk-unsplash.jpg")
background-size: cover
# Common Issues in Real-World Data and Their Consequences

???

In this lesson, we‚Äôll go over most common issues that we encounter in real-world data. The files and datasets that we receive or come across for day-to-day use are never as usable as the ones we use when we‚Äôre learning.

So, in the following sections, we will learn how to identify these issues, and more importantly, how to fix them.

---

## üåç Real-world data

???

The thing with real-world data is that files and tables vary in how messy they are, and these issues can vary in how much they affect our workflows.

--

- May not be readily imported  

???

In some cases we might not be able to load the data into our software of choice, 

--


- May not function properly within analysis software  

???

or maybe we can, but they will not be immediately usable and we will not be able to get things done in the first place.

--

- Often contains issues that go unnoticed until they: 

  - break a workflow
  - introduce biases
  - waste resources (computational, $)  

???

Alternatively, real world data can have small issues that can go unnoticed until 
they either break something, or they introduce biases and errors. At this point it is likely that going back and fixing these issues will mean wasting time or resources.  

The good news is that most issues can be fixed before they trip up any data analysis or visualization, and simply by being aware of the most common issues we can make data usable more efficiently.

---

## General data cleaning workflows 

???

There is no single sequence for cleaning data, but I recommend this general workflow because these broad steps make our data usable in incremental steps.

--

.large[
**0\.** Rectangular data
]

???

The first prerequisite would be to make sure we have rectangular data, with usable rows and columns.

--

.large[
1\. Variable names
]

???

After that, it is advisable to have column names that mean something to us, and preferably with a consistent naming scheme. 

--

.large[
2\. Observational units
]

???

For the rows in our data, we want to be able to identify the observational units, and have one row for each observation.

--

.large[
3\. Grouping variables
]

???

Once we have usable rows and columns, then we can make sure that any variable that aggregates our observations into groups is doing so adequately.

---

## Less interpretation

???

Although there is no specific recipe to follow for cleaning data, there are some steps that we can do first because they will not interfere with the rest of our work. If we recognize any of these issues in our data, we can usually fix them first because they need less interpretation from us about why these issues are present in the first place.

--

.large[
Whitespace, duplication, letter case
]

???

For example, extra spaces between words are rarely intentional and present in our data because they mean something. More likely, they are typing mistakes or artifacts from prior data transformations, so we can just get rid of any spaces that we determine to be unwanted. This can also apply to inconsistencies in letter case, and unless we are specifically interested in how capitalization varies within our data, we can usually fix this straight away.  Same with duplicate entries.

--

## More interpretation

???

On the other hand, there are issues in our data for which we need to stop and make a more careful interpretation.

--
.large[
Cleaning numeric variables, unbreaking values, extracting target data
]

???

For example, we might need to figure out what it means if a numeric variable has inconsistent decimal symbols or annotations, or if values are broken across more than one row or column, what criteria were used to break them. This will become clear as we go over the most common issues.

---
class: center, middle, dk-section-title
background-image:url("images/james-rathmell-t0iwmK0WC0Y-unsplash.jpg")
background-size: cover
# Unusable Headers 

???

Whether our data has a only handful of rows and columns, or millions of observations for hundreds of columns, we need ways of referring to each column. To refer efficiently to 2 or 2000 columns, we need them to have usable, informative names.

The names for the columns in our data are in the first row, or the header. If the headers have issues, we need to address them before we proceed.  This is why sorting out headers is the first general step in our workflow.

---

## Unusable headers 


Inconsistent or uninformative names  

<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#iwvlwbvmzl .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#iwvlwbvmzl .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#iwvlwbvmzl .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#iwvlwbvmzl .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#iwvlwbvmzl .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iwvlwbvmzl .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#iwvlwbvmzl .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#iwvlwbvmzl .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#iwvlwbvmzl .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#iwvlwbvmzl .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#iwvlwbvmzl .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#iwvlwbvmzl .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#iwvlwbvmzl .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#iwvlwbvmzl .gt_from_md > :first-child {
  margin-top: 0;
}

#iwvlwbvmzl .gt_from_md > :last-child {
  margin-bottom: 0;
}

#iwvlwbvmzl .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#iwvlwbvmzl .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#iwvlwbvmzl .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#iwvlwbvmzl .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#iwvlwbvmzl .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#iwvlwbvmzl .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#iwvlwbvmzl .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#iwvlwbvmzl .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iwvlwbvmzl .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#iwvlwbvmzl .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#iwvlwbvmzl .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#iwvlwbvmzl .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#iwvlwbvmzl .gt_left {
  text-align: left;
}

#iwvlwbvmzl .gt_center {
  text-align: center;
}

#iwvlwbvmzl .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#iwvlwbvmzl .gt_font_normal {
  font-weight: normal;
}

#iwvlwbvmzl .gt_font_bold {
  font-weight: bold;
}

#iwvlwbvmzl .gt_font_italic {
  font-style: italic;
}

#iwvlwbvmzl .gt_super {
  font-size: 65%;
}

#iwvlwbvmzl .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="iwvlwbvmzl" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 17px;">X</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 17px;">X1</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 17px;">X2</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="font-size: 17px;">mean_Score</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="font-size: 17px;">AVERAGE.SCORE</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left" style="font-size: 17px;">UMN</td>
<td class="gt_row gt_left" style="font-size: 17px;">EAST</td>
<td class="gt_row gt_left" style="font-size: 17px;">A</td>
<td class="gt_row gt_right" style="font-size: 17px;">7.7</td>
<td class="gt_row gt_right" style="font-size: 17px;">7.701</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 17px;">UV</td>
<td class="gt_row gt_left" style="font-size: 17px;">WEST</td>
<td class="gt_row gt_left" style="font-size: 17px;">B</td>
<td class="gt_row gt_right" style="font-size: 17px;">8.9</td>
<td class="gt_row gt_right" style="font-size: 17px;">8.890</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 17px;">UNLV</td>
<td class="gt_row gt_left" style="font-size: 17px;">EAST</td>
<td class="gt_row gt_left" style="font-size: 17px;">C</td>
<td class="gt_row gt_right" style="font-size: 17px;">9.2</td>
<td class="gt_row gt_right" style="font-size: 17px;">9.199</td></tr>
  </tbody>
  
  
</table></div>

--


- Distinct != informative 

--

- More difficult to remember and specify  

--

- Do not sort well  

???

There are many ways for headers to be unusable. The most common issue with headers is when they have Inconsistent or uninformative names.

In this example, column names in the header are all distinct, but they do not tell us much. This name has a dot between words and this one an underscore.

Names like these are more difficult to remember, and to refer to them  in functions. Another consequence of inconsistent naming is that columns will not sort well if we want to sort them alphabetically.

Inconsistent names are fixable with string manipulation, which we will do later on.

---

## Unusable headers

.pull-left[
Names broken across rows


<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#pmarbsxmma .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pmarbsxmma .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pmarbsxmma .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#pmarbsxmma .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#pmarbsxmma .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pmarbsxmma .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pmarbsxmma .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pmarbsxmma .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pmarbsxmma .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pmarbsxmma .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pmarbsxmma .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pmarbsxmma .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#pmarbsxmma .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pmarbsxmma .gt_from_md > :first-child {
  margin-top: 0;
}

#pmarbsxmma .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pmarbsxmma .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pmarbsxmma .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#pmarbsxmma .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pmarbsxmma .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#pmarbsxmma .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pmarbsxmma .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pmarbsxmma .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#pmarbsxmma .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pmarbsxmma .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pmarbsxmma .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#pmarbsxmma .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pmarbsxmma .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#pmarbsxmma .gt_left {
  text-align: left;
}

#pmarbsxmma .gt_center {
  text-align: center;
}

#pmarbsxmma .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pmarbsxmma .gt_font_normal {
  font-weight: normal;
}

#pmarbsxmma .gt_font_bold {
  font-weight: bold;
}

#pmarbsxmma .gt_font_italic {
  font-style: italic;
}

#pmarbsxmma .gt_super {
  font-size: 65%;
}

#pmarbsxmma .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="pmarbsxmma" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 17px;">X</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 17px;">X1</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 17px;">X2</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 17px;">mean</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 17px;">AVERAGE</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left" style="font-size: 17px;">NA</td>
<td class="gt_row gt_left" style="font-size: 17px;">NA</td>
<td class="gt_row gt_left" style="font-size: 17px;">NA</td>
<td class="gt_row gt_left" style="font-size: 17px;">Score</td>
<td class="gt_row gt_left" style="font-size: 17px;">SCORE</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 17px;">UMN</td>
<td class="gt_row gt_left" style="font-size: 17px;">EAST</td>
<td class="gt_row gt_left" style="font-size: 17px;">A</td>
<td class="gt_row gt_left" style="font-size: 17px;">7.7</td>
<td class="gt_row gt_left" style="font-size: 17px;">7.701</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 17px;">UV</td>
<td class="gt_row gt_left" style="font-size: 17px;">WEST</td>
<td class="gt_row gt_left" style="font-size: 17px;">B</td>
<td class="gt_row gt_left" style="font-size: 17px;">8.9</td>
<td class="gt_row gt_left" style="font-size: 17px;">8.89</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 17px;">UNLV</td>
<td class="gt_row gt_left" style="font-size: 17px;">EAST</td>
<td class="gt_row gt_left" style="font-size: 17px;">C</td>
<td class="gt_row gt_left" style="font-size: 17px;">9.2</td>
<td class="gt_row gt_left" style="font-size: 17px;">9.199</td></tr>
  </tbody>
  
  
</table></div>
]

--

.tr[
Variable names appear in &gt;1 rows  
]

--

.tr[
Header fragments mixed with data
]

--

.tr[
Separators become implicit  
]

--

.tr[
`NAs` introduced
]

???

Another common issue that makes headers unusable is when column names are broken across rows. This means that the header row only contains part of the column names, and the remaining parts are embedded in the first few rows which should only contain data. I‚Äôve seen this a lot when working with spreadsheets.

As we can see in this example, variable names appear outside of the header row, and fragments of the headers are mixed in data rows. The separator between fragments is nowhere to be seen, so we dont know if it was originally a space, a dot, a dash, underscore, or nothing. 

To make things worse, there are NA or empty values introduced for names that aren‚Äôt broken.

This can also fixed, but before we do so, let‚Äôs go over some good practices for naming variables.

---

## Cleaning column names

--

### Syntactically valid variable names

--

- Contain only letters, numbers, dots or underscores

--

- Start with a letter or a dot (not followed by a number)

--

- Not reserved words (_if_, _else_, _for_, _in_, _TRUE_, _NaN_, etc.)  

???

In the data organization section, we discussed good names for files, objects, and variables, but lets go a little deeper. Syntactically valid means that R will understand these names and that they will not cause any functions to fail. 

Valid names should not have special characters or reserved words meant for other uses, and start with a letter or a dot. Many of the functions that are involved in creating tables, data frames, and variables protect us from making invalid names, but we still need them to be informative and consistent.

---

## Cleaning column names 

.left-column[
&lt;/br&gt;
.large[
Rename or clean with .orange.b[regex]
]
]
.right-column[
.large[
Clean with .b.purple[`clean_names()`] from üì¶ **.rrured.b[`janitor`]**  
]

- Strips special characters

- Changes spaces and dots to underscores

- User-defined capitalization (default is snake_case)

]

???

To clean column names, we can always perform string manipulations on the names and use regular expressions, but the JANITOR package has a useful purpose-built function  for cleaning names. 

The clean names function will strip any special characters, replace spaces and dots with underscores, and apply a consistent letter case. 


---




```r
badnames
```

```
## # A tibble: 3 x 5
##   X     X1    X2    mean_Score AVERAGE.SCORE
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;         &lt;dbl&gt;
## 1 UMN   EAST  A            7.7          7.70
## 2 UV    WEST  B            8.9          8.89
## 3 UNLV  EAST  C            9.2          9.20
```


```r
badnames %&gt;% 
  clean_names()
```

```
## # A tibble: 3 x 5
##   x     x1    x2    mean_score average_score
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;         &lt;dbl&gt;
## 1 UMN   EAST  A            7.7          7.70
## 2 UV    WEST  B            8.9          8.89
## 3 UNLV  EAST  C            9.2          9.20
```

???

Here, this tibble object called badnames is piped into the clean names function, with no additional arguments, and in the resulting object all the names have consistent spacing and letter case.

---

## Broken headers




```r
badheaders
```

```
## # A tibble: 4 x 5
##   X     X1    X2    mean  AVERAGE
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  
## 1 &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  Score SCORE  
## 2 UMN   EAST  A     7.7   7.701  
## 3 UV    WEST  B     8.9   8.89   
## 4 UNLV  EAST  C     9.2   9.199
```

???

Clean names make headers usable, but if they are broken across rows, we can also use a purpose-built tool to put them together. This tibble object called badheaders has its headers broken across rows

---

## Broken headers

.large[
Mash the top _n_ data rows column-wise with .b.purple[`mash_colnames()`] from üì¶ .rrured.b[`unheadr`]
]


```r
badheaders %&gt;% 
*   mash_colnames(n_name_rows = 1, # number of data rows with header fragments
                   sep = "_") # separator for collapsing header fragments
```

&gt; Data rows exclude the header row

???

If we encounter this issue, we can use the mash colnames function from the unheadr package. 

Mash colnames has an n name rows argument, where we specify how many data rows have name fragments, we can also specify what to use as a separator when collapsing the header fragments. 

---


```r
badheaders %&gt;% 
  mash_colnames(n_name_rows = 1,
                sep = "_")
```

```
## # A tibble: 3 x 5
##   X     X1    X2    mean_Score AVERAGE_SCORE
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;        
## 1 UMN   EAST  A     7.7        7.701        
## 2 UV    WEST  B     8.9        8.89         
## 3 UNLV  EAST  C     9.2        9.199
```



```r
badheaders %&gt;% 
  mash_colnames(n_name_rows = 1,
                sep = "_") %&gt;% 
  clean_names()
```

```
## # A tibble: 3 x 5
##   x     x1    x2    mean_score average_score
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;        
## 1 UMN   EAST  A     7.7        7.701        
## 2 UV    WEST  B     8.9        8.89         
## 3 UNLV  EAST  C     9.2        9.199
```

???

In this case there is one row with parts of the names, and we want to use an underscore for the new names.

After that, we can pipe the resulting object into clean names, which will give us consistent letter case.

---

class: my-turn
## My turn

.large[
- Import a .csv file with problematic headers (MPAS-mine.csv)
]

--

.large[
- Make the variable names usable by placing all header fragments in a single header row  
]

--

.large[
- Clean the names for consistency, using snake case
]

---

class: inverse

## Your turn

.large[
- Import a .csv file with problematic headers (MPAS-your.csv)
]

--

.large[
- Make the variable names usable by placing all header fragments in a single header row  
]

--

.large[
- Clean the names for consistency
]

---
class: center, middle, dk-section-title
background-image:url("images/farnoosh-abdollahi-vIkABUsLEDY-unsplash.jpg")
background-size: cover
# Whitespace

---

## Whitespace

.large[
Does not correspond to a visible character, but occupies space in a string.
]

--


```r
string_a &lt;- "This string starts with a T"
string_b &lt;- " This string starts with a space"
string_c &lt;- "This string has trailing whitespace "
tibble(strings=c(string_a,string_b,string_c))
```

```
## # A tibble: 3 x 1
##   strings                               
##   &lt;chr&gt;                                 
## 1 "This string starts with a T"         
## 2 " This string starts with a space"    
## 3 "This string has trailing whitespace "
```

---

class: middle


```r
string_a &lt;- "R for the rest of us"
string_b &lt;- " R for the rest of us"
string_c &lt;- "R for the rest of us "
string_d &lt;- " R for the rest of us "
string_e &lt;- "R for the   rest of us"
RrU &lt;- tibble(strings=c(string_a,string_b,string_c,string_d,string_e))
RrU
```

```
## # A tibble: 5 x 1
##   strings                 
##   &lt;chr&gt;                   
## 1 "R for the rest of us"  
## 2 " R for the rest of us" 
## 3 "R for the rest of us " 
## 4 " R for the rest of us "
## 5 "R for the   rest of us"
```

---


```r
RrU %&gt;% 
  distinct(strings)
```

```
## # A tibble: 5 x 1
##   strings                 
##   &lt;chr&gt;                   
## 1 "R for the rest of us"  
## 2 " R for the rest of us" 
## 3 "R for the rest of us " 
## 4 " R for the rest of us "
## 5 "R for the   rest of us"
```

---

## Issues

.large[
- Leading whitespace
]

--

.large[
- Trailing whitespace
]

--

.large[
- Duplicated whitespace within strings
]

---

## Diagnosing whitespace issues

&gt;**"R for the rest of us"**   
(six words, five spaces)  

--

Count words, then spaces


```r
str_count(RrU$strings, '\\w+')
```

```
## [1] 6 6 6 6 6
```

--


```r
str_count(RrU$strings, '\\s')
```

```
## [1] 5 6 6 7 7
```

---

### Ambiguous strings

**`is.ambiguous_string()`**  

.large[
- Unexported function from üì¶ .rrured.b[`pillar`]
- Used by üì¶ .rrured.b[`tibble`] to reveal ambiguous strings when printing to console
- Ambiguous strings defined with a .orange.b[regexp]]


```r
function (x) 
{
  !is.na(x) &amp; grepl("^$|^ | $|\\\\|\"", x)
}
```

---


```r
RrU %&gt;% mutate(is_ambiguous = pillar:::is_ambiguous_string(strings))
```

```
## # A tibble: 5 x 2
##   strings                  is_ambiguous
##   &lt;chr&gt;                    &lt;lgl&gt;       
## 1 "R for the rest of us"   FALSE       
## 2 " R for the rest of us"  TRUE        
## 3 "R for the rest of us "  TRUE        
## 4 " R for the rest of us " TRUE        
## 5 "R for the   rest of us" FALSE
```


```r
RrU %&gt;% mutate(is_ambiguous = str_detect(strings,"^$|^ | $"))
```

```
## # A tibble: 5 x 2
##   strings                  is_ambiguous
##   &lt;chr&gt;                    &lt;lgl&gt;       
## 1 "R for the rest of us"   FALSE       
## 2 " R for the rest of us"  TRUE        
## 3 "R for the rest of us "  TRUE        
## 4 " R for the rest of us " TRUE        
## 5 "R for the   rest of us" FALSE
```

---

.large[
Check **all** columns of type _character_
]


```r
RrU %&gt;% 
  mutate(across(where(is.character), pillar:::is_ambiguous_string))
```

```
## # A tibble: 5 x 1
##   strings
##   &lt;lgl&gt;  
## 1 FALSE  
## 2 TRUE   
## 3 TRUE   
## 4 TRUE   
## 5 FALSE
```

---

.large[
Check **all** columns of type _character_
]


```r
RrU %&gt;% 
  mutate(across(where(is.character), str_detect,"^$|^ | $"))
```

```
## # A tibble: 5 x 1
##   strings
##   &lt;lgl&gt;  
## 1 FALSE  
## 2 TRUE   
## 3 TRUE   
## 4 TRUE   
## 5 FALSE
```

---

## Removing whitespace: .b.purple[`trim_ws()`]

.large[
Argument to `read_x` functions in üì¶ .rrured.b[`readr`]
]

--

.large[
Trims leading and trailing whitespace from each field during import. 
]

--

`TRUE` by default for **`read_csv()`** and **`read_tsv()`**  

--

`FALSE` by default for **`read_delim()`**

---

## Removing whitespace: .b.purple[`str_squish()`]

String manipulation function from üì¶ **.rrured.b[`stringr`]**   

Removes whitespace from the start and end of a string and reduces repeated whitespace inside the string

--


```r
RrU %&gt;% 
  mutate(strings_sq = str_squish(strings))
```

```
## # A tibble: 5 x 2
##   strings                  strings_sq          
##   &lt;chr&gt;                    &lt;chr&gt;               
## 1 "R for the rest of us"   R for the rest of us
## 2 " R for the rest of us"  R for the rest of us
## 3 "R for the rest of us "  R for the rest of us
## 4 " R for the rest of us " R for the rest of us
## 5 "R for the   rest of us" R for the rest of us
```

---

## Count words and spaces (again)  

.large[
**"R for the rest of us"** (six words, five spaces)
]


```r
str_count(RrU$strings_sq, '\\w+')
```

```
## integer(0)
```

```r
str_count(RrU$strings_sq, '\\s')
```

```
## integer(0)
```

---

## Check ambiguous strings (again)




```r
RrU %&gt;% mutate(across(where(is.character), str_detect,"^$|^ | $"))
```

```
## # A tibble: 5 x 1
##   strings
##   &lt;lgl&gt;  
## 1 FALSE  
## 2 TRUE   
## 3 TRUE   
## 4 TRUE   
## 5 FALSE
```

---

## Check ambiguous strings (again)


```r
RrU %&gt;% 
  mutate(strings = str_squish(strings)) %&gt;% 
  distinct()
```

```
## # A tibble: 1 x 1
##   strings             
##   &lt;chr&gt;               
## 1 R for the rest of us
```

---

class: my-turn

# My turn

.large[
- In the Marine Protected Areas dataset from the previous lesson (MPAS-mine.csv), check the _geographic_location_ variable for leading or trailing whitespace and remove it if necessary.
]

---

class: inverse

# Your turn

.large[
- In the Marine Protected Areas dataset from the previous lesson (MPAS-your.csv), check the _Country_ variable for leading or trailing whitespace and remove it if necessary.
]

---

class: center, middle, dk-section-title
background-image:url("images/snake-mylene2401.jpg")
background-size: fill
# Letter Case 

---

## Letter case

### üß∂ Strings in R are ‚å®Ô∏è case sensitive

Addressing letter case issues:

--

- Removes unwanted variation

--

- Improves noise/signal ratio

--

- Adds consistency 

--

- Improves readability (more shape contrast in lower vs. upper case, for many popular fonts)

---



.panelset[
.panel[.panel-name[Districts]
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#vismsylwlz .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #f4f4f9;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vismsylwlz .gt_heading {
  background-color: #f4f4f9;
  text-align: center;
  border-bottom-color: #f4f4f9;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vismsylwlz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #f4f4f9;
  border-bottom-width: 0;
}

#vismsylwlz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #f4f4f9;
  border-top-width: 0;
}

#vismsylwlz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vismsylwlz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vismsylwlz .gt_col_heading {
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vismsylwlz .gt_column_spanner_outer {
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vismsylwlz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vismsylwlz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vismsylwlz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vismsylwlz .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#vismsylwlz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vismsylwlz .gt_from_md > :first-child {
  margin-top: 0;
}

#vismsylwlz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vismsylwlz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vismsylwlz .gt_stub {
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#vismsylwlz .gt_summary_row {
  color: #333333;
  background-color: #f4f4f9;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vismsylwlz .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#vismsylwlz .gt_grand_summary_row {
  color: #333333;
  background-color: #f4f4f9;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vismsylwlz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vismsylwlz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vismsylwlz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vismsylwlz .gt_footnotes {
  color: #333333;
  background-color: #f4f4f9;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vismsylwlz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#vismsylwlz .gt_sourcenotes {
  color: #333333;
  background-color: #f4f4f9;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vismsylwlz .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#vismsylwlz .gt_left {
  text-align: left;
}

#vismsylwlz .gt_center {
  text-align: center;
}

#vismsylwlz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vismsylwlz .gt_font_normal {
  font-weight: normal;
}

#vismsylwlz .gt_font_bold {
  font-weight: bold;
}

#vismsylwlz .gt_font_italic {
  font-style: italic;
}

#vismsylwlz .gt_super {
  font-size: 65%;
}

#vismsylwlz .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="vismsylwlz" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 22px;">District</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="font-size: 22px;">Contribution.(USD)</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="font-size: 22px;">Constituents</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left" style="font-size: 22px;">Orange walk</td>
<td class="gt_row gt_right" style="font-size: 22px;">10990</td>
<td class="gt_row gt_right" style="font-size: 22px;">12</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 22px;">TOLEDO</td>
<td class="gt_row gt_right" style="font-size: 22px;">30000</td>
<td class="gt_row gt_right" style="font-size: 22px;">7</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 22px;">Stann Creek</td>
<td class="gt_row gt_right" style="font-size: 22px;">3400</td>
<td class="gt_row gt_right" style="font-size: 22px;">9</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 22px;">Toledo</td>
<td class="gt_row gt_right" style="font-size: 22px;">21999</td>
<td class="gt_row gt_right" style="font-size: 22px;">7</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 22px;">Orange WalK</td>
<td class="gt_row gt_right" style="font-size: 22px;">8800</td>
<td class="gt_row gt_right" style="font-size: 22px;">12</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 22px;">Orange Walk</td>
<td class="gt_row gt_right" style="font-size: 22px;">800</td>
<td class="gt_row gt_right" style="font-size: 22px;">12</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 22px;">Orange Walk</td>
<td class="gt_row gt_right" style="font-size: 22px;">55000</td>
<td class="gt_row gt_right" style="font-size: 22px;">12</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 22px;">stann creek</td>
<td class="gt_row gt_right" style="font-size: 22px;">22999</td>
<td class="gt_row gt_right" style="font-size: 22px;">9</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 22px;">Toledo</td>
<td class="gt_row gt_right" style="font-size: 22px;">4900</td>
<td class="gt_row gt_right" style="font-size: 22px;">7</td></tr>
  </tbody>
  
  
</table></div>
]

.panel[.panel-name[Data setup]

```r
districts &lt;- tibble::tribble(
  ~District, ~`Contribution.(USD)`, ~Constituents,
  "Orange walk",                10990L,           12L,
  "TOLEDO",                30000L,            7L,
  "Stann Creek",                 3400L,            9L,
  "Toledo",                21999L,            7L,
  "Orange WalK",                 8800L,           12L,
  "Orange Walk",                  800L,           12L,
  "Orange Walk",                55000L,           12L,
  "stann creek",                22999L,            9L,
  "Toledo",                 4900L,            7L
)
```
]
]

---

## Total contributions by district

```r
districts %&gt;% 
  group_by(District) %&gt;% 
  summarize(total_contribution = sum(`Contribution.(USD)`))
```

```
## # A tibble: 7 x 2
##   District    total_contribution
## * &lt;chr&gt;                    &lt;int&gt;
## 1 Orange walk              10990
## 2 Orange Walk              55800
## 3 Orange WalK               8800
## 4 stann creek              22999
## 5 Stann Creek               3400
## 6 Toledo                   26899
## 7 TOLEDO                   30000
```

---

## Detecting lower and upper case


```r
districts %&gt;% 
  mutate(lowercase = str_detect(District,"^[a-z\\s]+$"),
         uppercase = str_detect(District,"^[A-Z\\s]+$")) %&gt;% 
  select(District, lowercase, uppercase)
```

```
## # A tibble: 9 x 3
##   District    lowercase uppercase
##   &lt;chr&gt;       &lt;lgl&gt;     &lt;lgl&gt;    
## 1 Orange walk FALSE     FALSE    
## 2 TOLEDO      FALSE     TRUE     
## 3 Stann Creek FALSE     FALSE    
## 4 Toledo      FALSE     FALSE    
## 5 Orange WalK FALSE     FALSE    
## 6 Orange Walk FALSE     FALSE    
## 7 Orange Walk FALSE     FALSE    
## 8 stann creek TRUE      FALSE    
## 9 Toledo      FALSE     FALSE
```

---

## Changing case with üì¶ .rrured.b[`snakecase`]    


```r
to_any_case(strings, case)
```
--

.pull-left[
**camelCase** - capitalize all words following the first word, no spaces  

**snake_case** - all lowercase, underscores between words  

**slug-case** - all lowercase, dashes between words  
]

.pull-right[
**Title case** - All words capitalized except articles (_a_, _the_, _and_, etc.)  

**Sentence case** - First word capitalized, spaces between words  
]

---

## Convert case first with .b.purple[`to_any_case()`]



```r
districts %&gt;%
  mutate(District_clean = to_any_case(District, "title",
*                                     parsing_option = 0
  )) %&gt;%  
  group_by(District_clean) %&gt;%
  summarize(total_contribution = sum(`Contribution.(USD)`))
```

```
## # A tibble: 3 x 2
##   District_clean total_contribution
## * &lt;chr&gt;                       &lt;int&gt;
## 1 Orange Walk                 75590
## 2 Stann Creek                 26399
## 3 Toledo                      56899
```

&gt; .b.purple[`?to_any_case()`] for details on parsing options

---

## üì¶ .rrured.b[`snakecase`] shortcuts



```r
districts %&gt;% 
* mutate(District_clean = to_title_case(District,
*                                       parsing_option = 0
  )) %&gt;% 
  group_by(District_clean) %&gt;%
  summarize(total_contribution = sum(`Contribution.(USD)`))
```

```
## # A tibble: 3 x 2
##   District_clean total_contribution
## * &lt;chr&gt;                       &lt;int&gt;
## 1 Orange Walk                 75590
## 2 Stann Creek                 26399
## 3 Toledo                      56899
```

---

class: my-turn
## My turn

.large[
- Import the Marine Protected Areas dataset (MPAS-mine.csv) and summarize the number of Marine Protected Areas by United Nations Geoscheme Region (_UN Geoscheme_).
]

---

class: inverse
## Your turn

.large[
- Import the Marine Protected Areas dataset (MPAS-your.csv), and summarize the number of Marine Protected Areas by country (_Country full_).
]

---

class: center, middle, dk-section-title
background-image:url("images/hans-heiner-buhr-OKe4Q8azVNU-unsplash.jpg")
background-size: cover
# Missing, Implicit, or Misplaced Grouping Variables

---

### Missing ... ü§∑

---

### Implicit or misplaced

--

.large[
- Embedded as subheaders  
]

.large[
- Part of a compound value (next lesson)
]

---

## Embedded subheaders

.left-column[
**Hot drinks**
Coffee  
Tea  
Hot chocolate
**Cold Drinks**
Soda  
Juice  
Water  
Beer  
]

--

.right-column[

- Rows that correspond to values in grouping variables   

- Embedded in the data rectangle instead of in their own column   

- Human-readable, but hard to work with (for example: calculating group-wise summaries)

]

---



.panelset[
.panel[.panel-name[Menu]
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#tpfgoyoyni .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #f4f4f9;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#tpfgoyoyni .gt_heading {
  background-color: #f4f4f9;
  text-align: center;
  border-bottom-color: #f4f4f9;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tpfgoyoyni .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #f4f4f9;
  border-bottom-width: 0;
}

#tpfgoyoyni .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #f4f4f9;
  border-top-width: 0;
}

#tpfgoyoyni .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tpfgoyoyni .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tpfgoyoyni .gt_col_heading {
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#tpfgoyoyni .gt_column_spanner_outer {
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#tpfgoyoyni .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#tpfgoyoyni .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#tpfgoyoyni .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#tpfgoyoyni .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#tpfgoyoyni .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#tpfgoyoyni .gt_from_md > :first-child {
  margin-top: 0;
}

#tpfgoyoyni .gt_from_md > :last-child {
  margin-bottom: 0;
}

#tpfgoyoyni .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#tpfgoyoyni .gt_stub {
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#tpfgoyoyni .gt_summary_row {
  color: #333333;
  background-color: #f4f4f9;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tpfgoyoyni .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#tpfgoyoyni .gt_grand_summary_row {
  color: #333333;
  background-color: #f4f4f9;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tpfgoyoyni .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#tpfgoyoyni .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#tpfgoyoyni .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tpfgoyoyni .gt_footnotes {
  color: #333333;
  background-color: #f4f4f9;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tpfgoyoyni .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#tpfgoyoyni .gt_sourcenotes {
  color: #333333;
  background-color: #f4f4f9;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tpfgoyoyni .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#tpfgoyoyni .gt_left {
  text-align: left;
}

#tpfgoyoyni .gt_center {
  text-align: center;
}

#tpfgoyoyni .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#tpfgoyoyni .gt_font_normal {
  font-weight: normal;
}

#tpfgoyoyni .gt_font_bold {
  font-weight: bold;
}

#tpfgoyoyni .gt_font_italic {
  font-style: italic;
}

#tpfgoyoyni .gt_super {
  font-size: 65%;
}

#tpfgoyoyni .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="tpfgoyoyni" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 25px;">Item</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="font-size: 25px;">Price</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left" style="font-size: 25px;">Hot Drinks</td>
<td class="gt_row gt_right" style="font-size: 25px;">NA</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 25px;">Coffee</td>
<td class="gt_row gt_right" style="font-size: 25px;">12</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 25px;">Tea</td>
<td class="gt_row gt_right" style="font-size: 25px;">9</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 25px;">Hot chocolate</td>
<td class="gt_row gt_right" style="font-size: 25px;">9</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 25px;">Cold Drinks</td>
<td class="gt_row gt_right" style="font-size: 25px;">NA</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 25px;">Soda</td>
<td class="gt_row gt_right" style="font-size: 25px;">10</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 25px;">Juice</td>
<td class="gt_row gt_right" style="font-size: 25px;">13</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 25px;">Water</td>
<td class="gt_row gt_right" style="font-size: 25px;">8</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 25px;">Beer</td>
<td class="gt_row gt_right" style="font-size: 25px;">8</td></tr>
  </tbody>
  
  
</table></div>
]

.panel[.panel-name[Data setup]

```r
cafeteria &lt;- 
  tibble::tribble(
    ~Item, ~Price,
    "Hot Drinks",     NA,
    "Coffee",    12L,
    "Tea",     9L,
    "Hot chocolate",     9L,
    "Cold Drinks",     NA,
    "Soda",    10L,
    "Juice",    13L,
    "Water",     8L,
    "Beer",     8L
  )
```
]

.panel[.panel-name[Menu (tidy)]
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#pcggdslwdi .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #f4f4f9;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pcggdslwdi .gt_heading {
  background-color: #f4f4f9;
  text-align: center;
  border-bottom-color: #f4f4f9;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pcggdslwdi .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #f4f4f9;
  border-bottom-width: 0;
}

#pcggdslwdi .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #f4f4f9;
  border-top-width: 0;
}

#pcggdslwdi .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pcggdslwdi .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pcggdslwdi .gt_col_heading {
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pcggdslwdi .gt_column_spanner_outer {
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pcggdslwdi .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pcggdslwdi .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pcggdslwdi .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pcggdslwdi .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#pcggdslwdi .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pcggdslwdi .gt_from_md > :first-child {
  margin-top: 0;
}

#pcggdslwdi .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pcggdslwdi .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pcggdslwdi .gt_stub {
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#pcggdslwdi .gt_summary_row {
  color: #333333;
  background-color: #f4f4f9;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pcggdslwdi .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#pcggdslwdi .gt_grand_summary_row {
  color: #333333;
  background-color: #f4f4f9;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pcggdslwdi .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pcggdslwdi .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#pcggdslwdi .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pcggdslwdi .gt_footnotes {
  color: #333333;
  background-color: #f4f4f9;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pcggdslwdi .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#pcggdslwdi .gt_sourcenotes {
  color: #333333;
  background-color: #f4f4f9;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pcggdslwdi .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#pcggdslwdi .gt_left {
  text-align: left;
}

#pcggdslwdi .gt_center {
  text-align: center;
}

#pcggdslwdi .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pcggdslwdi .gt_font_normal {
  font-weight: normal;
}

#pcggdslwdi .gt_font_bold {
  font-weight: bold;
}

#pcggdslwdi .gt_font_italic {
  font-style: italic;
}

#pcggdslwdi .gt_super {
  font-size: 65%;
}

#pcggdslwdi .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="pcggdslwdi" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 22px;">Item</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="font-size: 22px;">Price</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 22px;">drink_type</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left" style="font-size: 22px;">Coffee</td>
<td class="gt_row gt_right" style="font-size: 22px;">12</td>
<td class="gt_row gt_left" style="font-size: 22px;">Hot Drinks</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 22px;">Tea</td>
<td class="gt_row gt_right" style="font-size: 22px;">9</td>
<td class="gt_row gt_left" style="font-size: 22px;">Hot Drinks</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 22px;">Hot chocolate</td>
<td class="gt_row gt_right" style="font-size: 22px;">9</td>
<td class="gt_row gt_left" style="font-size: 22px;">Hot Drinks</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 22px;">Soda</td>
<td class="gt_row gt_right" style="font-size: 22px;">10</td>
<td class="gt_row gt_left" style="font-size: 22px;">Cold Drinks</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 22px;">Juice</td>
<td class="gt_row gt_right" style="font-size: 22px;">13</td>
<td class="gt_row gt_left" style="font-size: 22px;">Cold Drinks</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 22px;">Water</td>
<td class="gt_row gt_right" style="font-size: 22px;">8</td>
<td class="gt_row gt_left" style="font-size: 22px;">Cold Drinks</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 22px;">Beer</td>
<td class="gt_row gt_right" style="font-size: 22px;">8</td>
<td class="gt_row gt_left" style="font-size: 22px;">Cold Drinks</td></tr>
  </tbody>
  
  
</table></div>
]

.panel[.panel-name[Data setup (tidy)]

```r
cafeteria_tidy &lt;- 
  tibble::tribble(
    ~Item, ~Price,   ~drink_type,
    "Coffee",    12L,  "Hot Drinks",
    "Tea",     9L,  "Hot Drinks",
    "Hot chocolate",     9L,  "Hot Drinks",
    "Soda",    10L, "Cold Drinks",
    "Juice",    13L, "Cold Drinks",
    "Water",     8L, "Cold Drinks",
    "Beer",     8L, "Cold Drinks"
  )
```
]
]

---

## Tidying embedded subheaders
.large[
.b.purple[`untangle2()`] from üì¶ .rrured.b[`unheadr`]
]

--

1. Match with a .orange.b[regular expression]

--

2. Position (sometimes) identifiable as the rows with NAs in all the variables except for the one with the subheaders

---

## `untangle2()`


```
## # A tibble: 9 x 2
##   Item          Price
##   &lt;chr&gt;         &lt;int&gt;
## 1 Hot Drinks       NA
## 2 Coffee           12
## 3 Tea               9
## 4 Hot chocolate     9
## 5 Cold Drinks      NA
## 6 Soda             10
## 7 Juice            13
## 8 Water             8
## 9 Beer              8
```

--


```r
untangle2(df,
          regex, # regular expression to match subheaders
          orig,  # variable with the subheaders
          new)   # name of the new variable with the group values
```

---

## `untangle2()`

Match using .orange.b[regex]

```r
cafeteria %&gt;% 
* untangle2("Drinks$", Item, drink_type) %&gt;%
  clean_names()
```

```
## # A tibble: 7 x 3
##   item          price drink_type 
##   &lt;chr&gt;         &lt;int&gt; &lt;chr&gt;      
## 1 Coffee           12 Hot Drinks 
## 2 Tea               9 Hot Drinks 
## 3 Hot chocolate     9 Hot Drinks 
## 4 Soda             10 Cold Drinks
## 5 Juice            13 Cold Drinks
## 6 Water             8 Cold Drinks
## 7 Beer              8 Cold Drinks
```

---

## `untangle2()`

.orange.b[Regexp] match and summarize

```r
cafeteria %&gt;% 
  untangle2("Drinks$", Item, drink_type) %&gt;% 
  clean_names()
```

```
## # A tibble: 7 x 3
##   item          price drink_type 
##   &lt;chr&gt;         &lt;int&gt; &lt;chr&gt;      
## 1 Coffee           12 Hot Drinks 
## 2 Tea               9 Hot Drinks 
## 3 Hot chocolate     9 Hot Drinks 
## 4 Soda             10 Cold Drinks
## 5 Juice            13 Cold Drinks
## 6 Water             8 Cold Drinks
## 7 Beer              8 Cold Drinks
```



```r
cafeteria %&gt;% 
  untangle2("Drinks$", Item, drink_type) %&gt;% 
  clean_names() %&gt;% 
  group_by(drink_type) %&gt;% 
  summarize(mean_price=mean(price))
```

```
## # A tibble: 2 x 2
##   drink_type  mean_price
## * &lt;chr&gt;            &lt;dbl&gt;
## 1 Cold Drinks       9.75
## 2 Hot Drinks       10
```

---

### Alternation


```r
cafeteria %&gt;% 
  untangle2("Hot Drinks|Cold Drinks", Item, drink_type) %&gt;% 
  clean_names()
```

```
## # A tibble: 7 x 3
##   item          price drink_type 
##   &lt;chr&gt;         &lt;int&gt; &lt;chr&gt;      
## 1 Coffee           12 Hot Drinks 
## 2 Tea               9 Hot Drinks 
## 3 Hot chocolate     9 Hot Drinks 
## 4 Soda             10 Cold Drinks
## 5 Juice            13 Cold Drinks
## 6 Water             8 Cold Drinks
## 7 Beer              8 Cold Drinks
```

---

### Alternation


```r
cafeteria %&gt;% 
  untangle2("Hot Drinks|Cold Drinks", Item, drink_type) %&gt;% 
  clean_names() %&gt;% 
  group_by(drink_type) %&gt;% 
  summarize(mean_price=mean(price))
```

```
## # A tibble: 2 x 2
##   drink_type  mean_price
## * &lt;chr&gt;            &lt;dbl&gt;
## 1 Cold Drinks       9.75
## 2 Hot Drinks       10
```

---

### Identify subheaders by context (`NA` values)


```r
cafeteria %&gt;%
  filter(across(-Item, is.na)) %&gt;%
  select(Item) %&gt;%
  mutate(tag = paste0("subheader_", Item)) %&gt;% 
  right_join(cafeteria) %&gt;%
  untangle2("^subheader", tag, drink_type) %&gt;%
  select(-tag) %&gt;%
  mutate(drink_type = stringr::str_remove(drink_type, "^subheader_"))
```

```
## # A tibble: 7 x 3
##   Item          Price drink_type 
##   &lt;chr&gt;         &lt;int&gt; &lt;chr&gt;      
## 1 Coffee           12 Cold Drinks
## 2 Tea               9 Cold Drinks
## 3 Hot chocolate     9 Cold Drinks
## 4 Soda             10 Cold Drinks
## 5 Juice            13 Cold Drinks
## 6 Water             8 Cold Drinks
## 7 Beer              8 Cold Drinks
```

---



```r
cafeteria %&gt;%
  filter(across(-Item, is.na)) %&gt;%
  select(Item) %&gt;%
  mutate(tag = paste0("subheader_", Item)) 
```

```
## # A tibble: 2 x 2
##   Item        tag                  
##   &lt;chr&gt;       &lt;chr&gt;                
## 1 Hot Drinks  subheader_Hot Drinks 
## 2 Cold Drinks subheader_Cold Drinks
```


--

Filter rows with NAs in all columns except the one holding the subheaders  

--

Keep only the column with subheaders  

--

Create a new variable that includes a pattern that can be matched with .orange.b[regex]


---



```r
... %&gt;%    
  right_join(cafeteria) %&gt;%
  untangle2("^subheader", tag, drink_type) %&gt;%
  select(-tag) %&gt;%
  mutate(drink_type = stringr::str_remove(drink_type, "^subheader_"))
```

--

Join resulting object with original data

--

Put implicit grouping variable into its own column

--

Clean up resulting data


---

class: my-turn
# My turn
.large[
- Load the `primates2017` dataset bundled with üì¶ `unheadr` and create a new column that groups the different species by geographic region. 
]

---

class: inverse
# Your turn
.large[
- Load the `primates2017` dataset bundled with üì¶ `unheadr` and create a new column that groups the different species by taxonomic family.  
]

&gt; In biology, taxonomic families all end in the suffix "_DAE_"  

.large[- How many different ways can you identify the embedded subheaders in these data?
]

---

class: center, middle, dk-section-title
background-image:url("images/max-vertsanov-qvRuue12Huw-unsplash.jpg")
background-size: fill
# Compound Values  

---

## Compound values

.large[
* Not tidy
]  

--

.large[
* Potential loss of variables or observations
]

---

### Tidying compound values 

.pull-left[Split on a delimiter, then:

**`separate()`** columns  

**`separate_rows()`**
]

.pull-right[
Match with .orange.b[regex], then:  

**`str_extract()`** substrings into new columns
]

---




.panelset[
.panel[.panel-name[Households]
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ovlkelhwul .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ovlkelhwul .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ovlkelhwul .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ovlkelhwul .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ovlkelhwul .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ovlkelhwul .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ovlkelhwul .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ovlkelhwul .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ovlkelhwul .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ovlkelhwul .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ovlkelhwul .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ovlkelhwul .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ovlkelhwul .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ovlkelhwul .gt_from_md > :first-child {
  margin-top: 0;
}

#ovlkelhwul .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ovlkelhwul .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ovlkelhwul .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#ovlkelhwul .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ovlkelhwul .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#ovlkelhwul .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ovlkelhwul .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ovlkelhwul .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ovlkelhwul .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ovlkelhwul .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ovlkelhwul .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#ovlkelhwul .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ovlkelhwul .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#ovlkelhwul .gt_left {
  text-align: left;
}

#ovlkelhwul .gt_center {
  text-align: center;
}

#ovlkelhwul .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ovlkelhwul .gt_font_normal {
  font-weight: normal;
}

#ovlkelhwul .gt_font_bold {
  font-weight: bold;
}

#ovlkelhwul .gt_font_italic {
  font-style: italic;
}

#ovlkelhwul .gt_super {
  font-size: 65%;
}

#ovlkelhwul .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="ovlkelhwul" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Participant.ID</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Education</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Residence</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Bonus</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">GHC21</td>
<td class="gt_row gt_left">Vocational</td>
<td class="gt_row gt_left">Living Alone-Cat</td>
<td class="gt_row gt_right">500</td></tr>
    <tr><td class="gt_row gt_left">MYL11</td>
<td class="gt_row gt_left">High School</td>
<td class="gt_row gt_left">Family Home-Cat</td>
<td class="gt_row gt_right">400</td></tr>
    <tr><td class="gt_row gt_left">LLB16</td>
<td class="gt_row gt_left">Graduate</td>
<td class="gt_row gt_left">Family Home-Dog</td>
<td class="gt_row gt_right">400</td></tr>
    <tr><td class="gt_row gt_left">AAH08</td>
<td class="gt_row gt_left">Vocational</td>
<td class="gt_row gt_left">Shared Housing-None</td>
<td class="gt_row gt_right">450</td></tr>
    <tr><td class="gt_row gt_left">PCG91</td>
<td class="gt_row gt_left">Vocational</td>
<td class="gt_row gt_left">Family Home-Other</td>
<td class="gt_row gt_right">500</td></tr>
    <tr><td class="gt_row gt_left">ACC22, PMM02</td>
<td class="gt_row gt_left">High School</td>
<td class="gt_row gt_left">Shared Housing-None</td>
<td class="gt_row gt_right">400</td></tr>
    <tr><td class="gt_row gt_left">MJM13</td>
<td class="gt_row gt_left">Postgraduate</td>
<td class="gt_row gt_left">Living Alone-Dog</td>
<td class="gt_row gt_right">500</td></tr>
  </tbody>
  
  
</table></div>
]

.panel[.panel-name[Data setup]

```r
households &lt;- 
  tibble::tribble(
    ~Participant.ID,     ~Education,            ~Residence, ~Bonus,
    "GHC21",   "Vocational",    "Living Alone-Cat",   500L,
    "MYL11",  "High School",     "Family Home-Cat",   400L,
    "LLB16",     "Graduate",     "Family Home-Dog",   400L,
    "AAH08",   "Vocational", "Shared Housing-None",   450L,
    "PCG91",   "Vocational",   "Family Home-Other",   500L,
    "ACC22, PMM02",  "High School", "Shared Housing-None",   400L,
    "MJM13", "Postgraduate",    "Living Alone-Dog",   500L
  )
```
]
]

---

## Separate Residence and 'Pet' variables

.large[
.b.purple[`separate_rows()`] from üì¶ .rrured.b[`tidyr`] 
]

.large[
- Turns a single character column into multiple columns
]

--

_Arguments_  

.b[`sep`]"  what separates values that should not be together in a single column  

.b[`into`]: names for the new columns to create

---

## Separate Residence and 'Pet' variables


```r
households %&gt;% 
  separate(col = Residence, # columns to separate
           into = c("Residence", "Pet"), # names of new variables to create 
           sep = "-")   # separator between columns
```

```
## # A tibble: 7 x 5
##   Participant.ID Education    Residence      Pet   Bonus
##   &lt;chr&gt;          &lt;chr&gt;        &lt;chr&gt;          &lt;chr&gt; &lt;int&gt;
## 1 GHC21          Vocational   Living Alone   Cat     500
## 2 MYL11          High School  Family Home    Cat     400
## 3 LLB16          Graduate     Family Home    Dog     400
## 4 AAH08          Vocational   Shared Housing None    450
## 5 PCG91          Vocational   Family Home    Other   500
## 6 ACC22, PMM02   High School  Shared Housing None    400
## 7 MJM13          Postgraduate Living Alone   Dog     500
```

---

### Match and extract
.large[
.orange.b[Regexp] for ~'last word in string'
]

```r
households %&gt;% 
  mutate(Pet = str_extract(Residence,"\\b\\w+$"))
```

```
## # A tibble: 7 x 5
##   Participant.ID Education    Residence           Bonus Pet  
##   &lt;chr&gt;          &lt;chr&gt;        &lt;chr&gt;               &lt;int&gt; &lt;chr&gt;
## 1 GHC21          Vocational   Living Alone-Cat      500 Cat  
## 2 MYL11          High School  Family Home-Cat       400 Cat  
## 3 LLB16          Graduate     Family Home-Dog       400 Dog  
## 4 AAH08          Vocational   Shared Housing-None   450 None 
## 5 PCG91          Vocational   Family Home-Other     500 Other
## 6 ACC22, PMM02   High School  Shared Housing-None   400 None 
## 7 MJM13          Postgraduate Living Alone-Dog      500 Dog
```

---

## Separate Participant IDs

.large[
.b.purple[`separate_rows()`] from üì¶ .rrured.b[`tidyr`] 
- Separates multiple delimited observations within a column and places each one in its own row.]

---

## Separate Participant IDs


```r
households %&gt;% 
  separate_rows(Participant.ID,
*               sep = ", ")
```

```
## # A tibble: 8 x 4
##   Participant.ID Education    Residence           Bonus
##   &lt;chr&gt;          &lt;chr&gt;        &lt;chr&gt;               &lt;int&gt;
## 1 GHC21          Vocational   Living Alone-Cat      500
## 2 MYL11          High School  Family Home-Cat       400
## 3 LLB16          Graduate     Family Home-Dog       400
## 4 AAH08          Vocational   Shared Housing-None   450
## 5 PCG91          Vocational   Family Home-Other     500
## 6 ACC22          High School  Shared Housing-None   400
## 7 PMM02          High School  Shared Housing-None   400
## 8 MJM13          Postgraduate Living Alone-Dog      500
```

---

class: my-turn
## My turn

.large[
- Import the Marine Protected Areas dataset (MPAS-mine.csv), separate the country codes variable (ISO3 and UN scheme) into columns the Reference variable into rows.]

--

.large[
- Which Reference appears the most?
]

---

class: inverse
## Your turn

.large[
- Import the Marine Protected Areas dataset (MPAS-your.csv), separate the country codes variable (ISO3 and UN scheme) into columns and the Reference variable into rows.]

--

&gt; Keep an eye on the separators

--

.large[
- Optional: Arrange the data by ISO3 country code
]

---

class: center, middle, dk-section-title
background-image:url("images/armelle-danjour-kwGqIuNrM5E-unsplash.jpg")
background-size: cover
# Duplicates  

---

## Problems with duplicates

--

.large[
- Bloat our data
]  

--

.large[
- Unintentional repetition can be costly
]  

--

.large[
- Inaccurate reporting (double counting, inflated or biased summary statistics)
]

---

## What can we do?

.large[
Identify with .b.purple[`get_dupes()`] from üì¶ .rrured.b[`janitor`]  
]

--

.large[
Discard with .b.purple[`distinct()`] from üì¶ .rrured.b[`dplyr`]  
]

---

## Duplicated values  

.large[
- Across all variables  
]

--

.large[
- Across the variable(s) defining the observational units  
]

--

.large[
- Across arbitrary sets of variables
]

---




.panelset[
.panel[.panel-name[pizza_orders]
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#wynyrjsdxz .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wynyrjsdxz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wynyrjsdxz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wynyrjsdxz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wynyrjsdxz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wynyrjsdxz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wynyrjsdxz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wynyrjsdxz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wynyrjsdxz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wynyrjsdxz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wynyrjsdxz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wynyrjsdxz .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#wynyrjsdxz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wynyrjsdxz .gt_from_md > :first-child {
  margin-top: 0;
}

#wynyrjsdxz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wynyrjsdxz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wynyrjsdxz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#wynyrjsdxz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wynyrjsdxz .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#wynyrjsdxz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wynyrjsdxz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wynyrjsdxz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wynyrjsdxz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wynyrjsdxz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wynyrjsdxz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#wynyrjsdxz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wynyrjsdxz .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#wynyrjsdxz .gt_left {
  text-align: left;
}

#wynyrjsdxz .gt_center {
  text-align: center;
}

#wynyrjsdxz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wynyrjsdxz .gt_font_normal {
  font-weight: normal;
}

#wynyrjsdxz .gt_font_bold {
  font-weight: bold;
}

#wynyrjsdxz .gt_font_italic {
  font-style: italic;
}

#wynyrjsdxz .gt_super {
  font-size: 65%;
}

#wynyrjsdxz .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="wynyrjsdxz" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 26px;">CustomerID</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 26px;">Address</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 26px;">City</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 26px;">State</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left" style="font-size: 26px;">Newman</td>
<td class="gt_row gt_left" style="font-size: 26px;">Apartment 5E, 129 West 81st Street</td>
<td class="gt_row gt_left" style="font-size: 26px;">New York City</td>
<td class="gt_row gt_left" style="font-size: 26px;">New York</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 26px;">susan_A</td>
<td class="gt_row gt_left" style="font-size: 26px;">185 West 74th Street</td>
<td class="gt_row gt_left" style="font-size: 26px;">New York City</td>
<td class="gt_row gt_left" style="font-size: 26px;">New York</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 26px;">susan_A</td>
<td class="gt_row gt_left" style="font-size: 26px;">185 West 74th Street</td>
<td class="gt_row gt_left" style="font-size: 26px;">New York City</td>
<td class="gt_row gt_left" style="font-size: 26px;">New York</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 26px;">js1994</td>
<td class="gt_row gt_left" style="font-size: 26px;">Apartment 5A, 129 West 81st Street</td>
<td class="gt_row gt_left" style="font-size: 26px;">New York City</td>
<td class="gt_row gt_left" style="font-size: 26px;">New York</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 26px;">Eric</td>
<td class="gt_row gt_left" style="font-size: 26px;">Unit 1B, 4186 Willoughby Avenue</td>
<td class="gt_row gt_left" style="font-size: 26px;">Brooklyn</td>
<td class="gt_row gt_left" style="font-size: 26px;">New York</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 26px;">Dash</td>
<td class="gt_row gt_left" style="font-size: 26px;">Unit 1B, 4186 Willoughby Avenue</td>
<td class="gt_row gt_left" style="font-size: 26px;">Brooklyn</td>
<td class="gt_row gt_left" style="font-size: 26px;">New York</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 26px;">Rakeem</td>
<td class="gt_row gt_left" style="font-size: 26px;">Unit 1B, 4186 Willoughby Avenue</td>
<td class="gt_row gt_left" style="font-size: 26px;">Brooklyn</td>
<td class="gt_row gt_left" style="font-size: 26px;">New York</td></tr>
  </tbody>
  
  
</table></div>
]

.panel[.panel-name[Data setup]

```r
pizza_orders &lt;- 
  tibble::tribble(
  ~CustomerID,                             ~Address,           ~City,     ~State,
     "Newman", "Apartment 5E, 129 West 81st Street", "New York City", "New York",
    "susan_A",               "185 West 74th Street", "New York City", "New York",
    "susan_A",               "185 West 74th Street", "New York City", "New York",
     "js1994", "Apartment 5A, 129 West 81st Street", "New York City", "New York",
       "Eric",    "Unit 1B, 4186 Willoughby Avenue",      "Brooklyn", "New York",
       "Dash",    "Unit 1B, 4186 Willoughby Avenue",      "Brooklyn", "New York",
     "Rakeem",    "Unit 1B, 4186 Willoughby Avenue",      "Brooklyn", "New York"
  )
```
]
]

---

.large[
Identify with .b.purple[`get_dupes()`] from üì¶ .rrured.b[`janitor`]  
]


```r
pizza_orders %&gt;% 
  get_dupes() # all variables by default
```

```
## # A tibble: 2 x 5
##   CustomerID Address              City          State    dupe_count
##   &lt;chr&gt;      &lt;chr&gt;                &lt;chr&gt;         &lt;chr&gt;         &lt;int&gt;
## 1 susan_A    185 West 74th Street New York City New York          2
## 2 susan_A    185 West 74th Street New York City New York          2
```

--

* Adds a `dupe_count` variable showing the number of rows sharing the duplicated values  
* Puts the input variables at the beginning of the resulting data frame 

---

.large[
.b.purple[`get_dupes()`] using variable with chosen observational unit
]


```r
pizza_orders %&gt;% 
  get_dupes(CustomerID)
```

```
## # A tibble: 2 x 5
##   CustomerID dupe_count Address              City          State   
##   &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;                &lt;chr&gt;         &lt;chr&gt;   
## 1 susan_A             2 185 West 74th Street New York City New York
## 2 susan_A             2 185 West 74th Street New York City New York
```

---

.large[
.b.purple[`get_dupes()`] with an arbirary set of variables
]
&gt; now accepts üì¶ .rrured.b[`tidyselect`] helpers


```r
pizza_orders %&gt;% 
  get_dupes(Address, starts_with("Cit")) 
```

```
## # A tibble: 5 x 5
##   Address                         City          dupe_count CustomerID State   
##   &lt;chr&gt;                           &lt;chr&gt;              &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;   
## 1 185 West 74th Street            New York City          2 susan_A    New York
## 2 185 West 74th Street            New York City          2 susan_A    New York
## 3 Unit 1B, 4186 Willoughby Avenue Brooklyn               3 Eric       New York
## 4 Unit 1B, 4186 Willoughby Avenue Brooklyn               3 Dash       New York
## 5 Unit 1B, 4186 Willoughby Avenue Brooklyn               3 Rakeem     New York
```

---

.large[
Discard with .b.purple[`distinct()`] from üì¶ .rrured.b[`dplyr`]
]


```r
pizza_orders %&gt;% 
  distinct() # all variables by default
```

```
## # A tibble: 6 x 4
##   CustomerID Address                            City          State   
##   &lt;chr&gt;      &lt;chr&gt;                              &lt;chr&gt;         &lt;chr&gt;   
## 1 Newman     Apartment 5E, 129 West 81st Street New York City New York
## 2 susan_A    185 West 74th Street               New York City New York
## 3 js1994     Apartment 5A, 129 West 81st Street New York City New York
## 4 Eric       Unit 1B, 4186 Willoughby Avenue    Brooklyn      New York
## 5 Dash       Unit 1B, 4186 Willoughby Avenue    Brooklyn      New York
## 6 Rakeem     Unit 1B, 4186 Willoughby Avenue    Brooklyn      New York
```

---

.large[
.b.purple[`distinct()`] using variable with the chosen observational unit
]


```r
pizza_orders %&gt;% 
  distinct(CustomerID, .keep_all = TRUE)
```

```
## # A tibble: 6 x 4
##   CustomerID Address                            City          State   
##   &lt;chr&gt;      &lt;chr&gt;                              &lt;chr&gt;         &lt;chr&gt;   
## 1 Newman     Apartment 5E, 129 West 81st Street New York City New York
## 2 susan_A    185 West 74th Street               New York City New York
## 3 js1994     Apartment 5A, 129 West 81st Street New York City New York
## 4 Eric       Unit 1B, 4186 Willoughby Avenue    Brooklyn      New York
## 5 Dash       Unit 1B, 4186 Willoughby Avenue    Brooklyn      New York
## 6 Rakeem     Unit 1B, 4186 Willoughby Avenue    Brooklyn      New York
```

--

&gt; Use `.keep_all = FALSE` (default) to drop all other variables

---

.large[
.b.purple[`distinct()`] with custom combination of variables
]


&gt;  üì¶ .b.rrured[`tidyselect`] helpers enabled by using .b[`across`] semantics


```r
pizza_orders %&gt;% 
  distinct(across(c(Address, starts_with("Cit")))) 
```

```
## # A tibble: 4 x 2
##   Address                            City         
##   &lt;chr&gt;                              &lt;chr&gt;        
## 1 Apartment 5E, 129 West 81st Street New York City
## 2 185 West 74th Street               New York City
## 3 Apartment 5A, 129 West 81st Street New York City
## 4 Unit 1B, 4186 Willoughby Avenue    Brooklyn
```

---

.large[
.b.purple[`distinct()`] with custom combination of variables
]

&gt;‚ö†Ô∏è If `.keep_all = TRUE` and there are duplicates in other variables, `distinct` only keeps the first row 


```r
pizza_orders %&gt;% 
  distinct(across(c(Address,starts_with("City"))), .keep_all = TRUE) 
```

```
## # A tibble: 4 x 4
##   CustomerID Address                            City          State   
##   &lt;chr&gt;      &lt;chr&gt;                              &lt;chr&gt;         &lt;chr&gt;   
## 1 Newman     Apartment 5E, 129 West 81st Street New York City New York
## 2 susan_A    185 West 74th Street               New York City New York
## 3 js1994     Apartment 5A, 129 West 81st Street New York City New York
## 4 Eric       Unit 1B, 4186 Willoughby Avenue    Brooklyn      New York
```

---

class: my-turn

# My turn

--

.large[
- Load the messy Age of Empires units dataset bundled with `unheadr` (AOEunits_raw) and discard units that are not of Type "Archer".
]

--

.large[
- Identify duplicated records across all variables.
]

--

.large[
- Remove duplicated records across all variables.
]

---

class: inverse
# Your turn

.large[
- Load the messy Age of Empires units dataset bundled with `unheadr` (AOEunits_raw) and keep only units of Type "Cavalry".
]

--

.large[
- Identify duplicated records across all variables.
]

--

.large[
- Remove duplicated records across all variables.
]

---

class: center, middle, dk-section-title
background-image:url("images/jonathan-safa-YcxOAC5DpDA-unsplash.jpg")
background-size: cover
# Broken Values

---

# Broken values

.large[
Values broken across rows, often to save horizontal space
]

--

.large[
`NA` or blank values introduced  
]

--

.large[
Problematic when grouping variables or observational units are broken
]

---




.panelset[
.panel[.panel-name[olympics]
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#yrgxztmvsi .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#yrgxztmvsi .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yrgxztmvsi .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#yrgxztmvsi .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#yrgxztmvsi .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yrgxztmvsi .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yrgxztmvsi .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#yrgxztmvsi .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#yrgxztmvsi .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#yrgxztmvsi .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#yrgxztmvsi .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#yrgxztmvsi .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#yrgxztmvsi .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#yrgxztmvsi .gt_from_md > :first-child {
  margin-top: 0;
}

#yrgxztmvsi .gt_from_md > :last-child {
  margin-bottom: 0;
}

#yrgxztmvsi .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#yrgxztmvsi .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#yrgxztmvsi .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yrgxztmvsi .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#yrgxztmvsi .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yrgxztmvsi .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#yrgxztmvsi .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#yrgxztmvsi .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yrgxztmvsi .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yrgxztmvsi .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#yrgxztmvsi .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yrgxztmvsi .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#yrgxztmvsi .gt_left {
  text-align: left;
}

#yrgxztmvsi .gt_center {
  text-align: center;
}

#yrgxztmvsi .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#yrgxztmvsi .gt_font_normal {
  font-weight: normal;
}

#yrgxztmvsi .gt_font_bold {
  font-weight: bold;
}

#yrgxztmvsi .gt_font_italic {
  font-style: italic;
}

#yrgxztmvsi .gt_super {
  font-size: 65%;
}

#yrgxztmvsi .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="yrgxztmvsi" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 20px;">Edition</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 20px;">Country</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 20px;">Soccer.gold.medal.(men)</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 20px;">Wrestling.(men.middleweight)</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left" style="font-size: 20px;">NA</td>
<td class="gt_row gt_left" style="font-size: 20px;">NA</td>
<td class="gt_row gt_left" style="font-size: 20px;">NA</td>
<td class="gt_row gt_left" style="font-size: 20px;">weight class limit:</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 20px;">NA</td>
<td class="gt_row gt_left" style="font-size: 20px;">NA</td>
<td class="gt_row gt_left" style="font-size: 20px;">NA</td>
<td class="gt_row gt_left" style="font-size: 20px;">82 kg</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 20px;">Los Angeles 1984</td>
<td class="gt_row gt_left" style="font-size: 20px;">USA</td>
<td class="gt_row gt_left" style="font-size: 20px;">France</td>
<td class="gt_row gt_left" style="font-size: 20px;">USA</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 20px;">Barcelona</td>
<td class="gt_row gt_left" style="font-size: 20px;">Spain</td>
<td class="gt_row gt_left" style="font-size: 20px;">Spain</td>
<td class="gt_row gt_left" style="font-size: 20px;">USA</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 20px;">1992</td>
<td class="gt_row gt_left" style="font-size: 20px;">NA</td>
<td class="gt_row gt_left" style="font-size: 20px;">NA</td>
<td class="gt_row gt_left" style="font-size: 20px;">NA</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 20px;">Atlanta 1996</td>
<td class="gt_row gt_left" style="font-size: 20px;">USA</td>
<td class="gt_row gt_left" style="font-size: 20px;">Nigeria</td>
<td class="gt_row gt_left" style="font-size: 20px;">Russia</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 20px;">NA</td>
<td class="gt_row gt_left" style="font-size: 20px;">NA</td>
<td class="gt_row gt_left" style="font-size: 20px;">NA</td>
<td class="gt_row gt_left" style="font-size: 20px;">weight class limit:</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 20px;">NA</td>
<td class="gt_row gt_left" style="font-size: 20px;">NA</td>
<td class="gt_row gt_left" style="font-size: 20px;">NA</td>
<td class="gt_row gt_left" style="font-size: 20px;">85 kg</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 20px;">Sydney 2000</td>
<td class="gt_row gt_left" style="font-size: 20px;">Australia</td>
<td class="gt_row gt_left" style="font-size: 20px;">Cameroon</td>
<td class="gt_row gt_left" style="font-size: 20px;">Russia</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 20px;">London</td>
<td class="gt_row gt_left" style="font-size: 20px;">UK</td>
<td class="gt_row gt_left" style="font-size: 20px;">Mexico</td>
<td class="gt_row gt_left" style="font-size: 20px;">Azerbaijan</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 20px;">2012</td>
<td class="gt_row gt_left" style="font-size: 20px;">NA</td>
<td class="gt_row gt_left" style="font-size: 20px;">NA</td>
<td class="gt_row gt_left" style="font-size: 20px;">NA</td></tr>
  </tbody>
  
  
</table></div>
]

.panel[.panel-name[Data setup]

```r
olympics &lt;- 
  tibble::tribble(
    ~Edition,    ~Country, ~`Soccer.gold.medal.(men)`, ~`Wrestling.(men.middleweight)`,
    NA,          NA,                         NA,           "weight class limit:",
    NA,          NA,                         NA,                         "82 kg",
    "Los Angeles 1984",       "USA",                   "France",                           "USA",
    "Barcelona",     "Spain",                    "Spain",                           "USA",
    "1992",          NA,                         NA,                              NA,
    "Atlanta 1996",       "USA",                  "Nigeria",                        "Russia",
    NA,          NA,                         NA,           "weight class limit:",
    NA,          NA,                         NA,                         "85 kg",
    "Sydney 2000", "Australia",                 "Cameroon",                        "Russia",
    "London",        "UK",                   "Mexico",                    "Azerbaijan",
    "2012",          NA,                         NA,                              NA
  )
```
]
]

---

## 'Unbreaking' values 

--

.large[
For values broken up across **two consecutive rows**:
]

--

.large[
Match the trailing or leading half of the value with a .orange.b[regexp] and üì¶ .rrured.b[`unheadr`]
]
---

## 'Unbreaking' values 

.pull-left[
Fast  
food  
Casual dining  
Thai  
Pizzeria  
Cakes and  
ice cream  
]  

.pull-right[
Retriever  
(flat-coated)  
Bulldog (American)   
Bullmastiff  
Retriever  
(golden)  
Poodle  
]

---

## 'Unbreaking' values

.pull-left[
Fast  
**food**  
Casual dining  
Thai  
Pizzeria  
Cakes and  
**ice cream**  
]  

.pull-right[
Retriever  
**(flat-coated)**  
Bulldog (American)   
Bullmastiff  
Retriever  
**(golden)**  
Poodle  
]

---

## .purple[**`unbreak_vals()`**]  

.large[
verb-like function from üì¶ .rrured.b[`unheadr`]

Match the trailing half of the broken value with a .orange.b[regular expression]
]

```r
unbreak_vals(df, 
             regex, 
             ogcol, 
             newcol, 
             sep = " ",
)
```

---

## Trailing row



```r
olympics %&gt;% 
  unbreak_vals(regex = "^\\d", # numbers at start of string
               ogcol = Edition,
               newcol = Edition_ub,
               sep = " ")
```

```
## # A tibble: 9 x 4
##   Edition_ub       Country   `Soccer.gold.medal.(me‚Ä¶ `Wrestling.(men.middleweig‚Ä¶
##   &lt;chr&gt;            &lt;chr&gt;     &lt;chr&gt;                   &lt;chr&gt;                      
## 1 &lt;NA&gt;             &lt;NA&gt;      &lt;NA&gt;                    weight class limit:        
## 2 &lt;NA&gt;             &lt;NA&gt;      &lt;NA&gt;                    82 kg                      
## 3 Los Angeles 1984 USA       France                  USA                        
## 4 Barcelona 1992   Spain     Spain                   USA                        
## 5 Atlanta 1996     USA       Nigeria                 Russia                     
## 6 &lt;NA&gt;             &lt;NA&gt;      &lt;NA&gt;                    weight class limit:        
## 7 &lt;NA&gt;             &lt;NA&gt;      &lt;NA&gt;                    85 kg                      
## 8 Sydney 2000      Australia Cameroon                Russia                     
## 9 London 2012      UK        Mexico                  Azerbaijan
```

---

### .purple[**`unbreak_rows()`**]  


Verb for merging rows from üì¶ .rrured.b[`unheadr`]

Match the leading half of the broken value with .orange.b[regular expression]



```r
unbreak_rows(df, 
             regex, 
             ogcol, 
             sep = " ")
```

---

## Leading row


```r
olympics %&gt;% unbreak_rows(regex = "^weight", # numbers at start of string
                          ogcol = `Wrestling.(men.middleweight)`,
                          sep = " ")
```

```
## # A tibble: 9 x 4
##   Edition          Country     `Soccer.gold.medal.(m‚Ä¶ `Wrestling.(men.middlewei‚Ä¶
##   &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;                  &lt;chr&gt;                     
## 1 ""               ""          ""                     weight class limit: 82 kg 
## 2 "Los Angeles 19‚Ä¶ "USA"       "France"               USA                       
## 3 "Barcelona"      "Spain"     "Spain"                USA                       
## 4  &lt;NA&gt;             &lt;NA&gt;        &lt;NA&gt;                  &lt;NA&gt;                      
## 5 "Atlanta 1996"   "USA"       "Nigeria"              Russia                    
## 6 ""               ""          ""                     weight class limit: 85 kg 
## 7 "Sydney 2000"    "Australia" "Cameroon"             Russia                    
## 8 "London"         "UK"        "Mexico"               Azerbaijan                
## 9  &lt;NA&gt;             &lt;NA&gt;        &lt;NA&gt;                  &lt;NA&gt;
```

---

## Leading and trailing rows


```r
olympics %&gt;%
  unbreak_rows(
    regex = "^weight",
    ogcol = `Wrestling.(men.middleweight)`) %&gt;%
  unbreak_vals(regex = "^\\d", # numbers at start of string
               ogcol = Edition,
               newcol = Edition_ub)
```

```
## # A tibble: 0 x 4
## # ‚Ä¶ with 4 variables: Edition_ub &lt;chr&gt;, Country &lt;chr&gt;,
## #   `Soccer.gold.medal.(men)` &lt;chr&gt;, `Wrestling.(men.middleweight)` &lt;chr&gt;
```

---

class: my-turn

# My turn

--

.large[
- Load the messy Age of Empires units dataset from csv (aoe_raw.csv)
]

--

.large[
- Identify the broken values in the 'Type' column and unbreak them
]

---

class: inverse
# Your turn

--

.large[
- Load the messy Age of Empires units dataset from csv (aoe_raw.csv)
]

--

.large[
- Identify the broken values in both the 'Type' and 'Name' columns and unbreak them
]

--

.large[
- Clean up any separator-related issues arising from the 'unbreaking'
]

---

class: center, middle, dk-section-title
background-image:url("images/david-hertle-8HAhmMk9HJI-unsplash.jpg")
background-size: cover

# Empty Rows and Columns

---

### Problems with empty rows and columns

--
.large[
- Common when importing files
]

--

.large[
- Problematic when referring to variables by position or ranges of consecutive variables  (`:`)  
]

--

.large[
- Potentially disruptive when filling adjacent cells
]

---

# What can we do?

--

.large[
**Identify** with üì¶ .rrured.b[`dplyr`]  
]

--

.large[
**Discard** with .purple[**`remove_empty()`**] from üì¶ .rrured.b[`janitor`]
]

---



.panelset[
.panel[.panel-name[universities]
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ojytsrynvu .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #f4f4f9;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ojytsrynvu .gt_heading {
  background-color: #f4f4f9;
  text-align: center;
  border-bottom-color: #f4f4f9;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ojytsrynvu .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #f4f4f9;
  border-bottom-width: 0;
}

#ojytsrynvu .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #f4f4f9;
  border-top-width: 0;
}

#ojytsrynvu .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ojytsrynvu .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ojytsrynvu .gt_col_heading {
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ojytsrynvu .gt_column_spanner_outer {
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ojytsrynvu .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ojytsrynvu .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ojytsrynvu .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ojytsrynvu .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ojytsrynvu .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ojytsrynvu .gt_from_md > :first-child {
  margin-top: 0;
}

#ojytsrynvu .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ojytsrynvu .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ojytsrynvu .gt_stub {
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#ojytsrynvu .gt_summary_row {
  color: #333333;
  background-color: #f4f4f9;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ojytsrynvu .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#ojytsrynvu .gt_grand_summary_row {
  color: #333333;
  background-color: #f4f4f9;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ojytsrynvu .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ojytsrynvu .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ojytsrynvu .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ojytsrynvu .gt_footnotes {
  color: #333333;
  background-color: #f4f4f9;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ojytsrynvu .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#ojytsrynvu .gt_sourcenotes {
  color: #333333;
  background-color: #f4f4f9;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ojytsrynvu .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#ojytsrynvu .gt_left {
  text-align: left;
}

#ojytsrynvu .gt_center {
  text-align: center;
}

#ojytsrynvu .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ojytsrynvu .gt_font_normal {
  font-weight: normal;
}

#ojytsrynvu .gt_font_bold {
  font-weight: bold;
}

#ojytsrynvu .gt_font_italic {
  font-style: italic;
}

#ojytsrynvu .gt_super {
  font-size: 65%;
}

#ojytsrynvu .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="ojytsrynvu" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="font-size: 14px;">ID</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 14px;">Institution</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="font-size: 14px;">year</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 14px;">ZIP.code</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 14px;">Highest.degree.offered</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="font-size: 14px;">County.name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 14px;">Religious.affiliation</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td></tr>
    <tr><td class="gt_row gt_right" style="font-size: 14px;">100663</td>
<td class="gt_row gt_left" style="font-size: 14px;">University of Alabama at Birmingham</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">35294-0110</td>
<td class="gt_row gt_left" style="font-size: 14px;">Doctor's degree</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">Not applicable</td></tr>
    <tr><td class="gt_row gt_right" style="font-size: 14px;">100690</td>
<td class="gt_row gt_left" style="font-size: 14px;">Amridge University</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">36117-3553</td>
<td class="gt_row gt_left" style="font-size: 14px;">Doctor's degree</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">Churches of Christ</td></tr>
    <tr><td class="gt_row gt_right" style="font-size: 14px;">100706</td>
<td class="gt_row gt_left" style="font-size: 14px;">University of Alabama in Huntsville</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">35899</td>
<td class="gt_row gt_left" style="font-size: 14px;">Doctor's degree</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">Not applicable</td></tr>
    <tr><td class="gt_row gt_right" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td></tr>
    <tr><td class="gt_row gt_right" style="font-size: 14px;">100751</td>
<td class="gt_row gt_left" style="font-size: 14px;">The University of Alabama</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">35487-0166</td>
<td class="gt_row gt_left" style="font-size: 14px;">Doctor's degree</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">Not applicable</td></tr>
    <tr><td class="gt_row gt_right" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td></tr>
    <tr><td class="gt_row gt_right" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td></tr>
    <tr><td class="gt_row gt_right" style="font-size: 14px;">101541</td>
<td class="gt_row gt_left" style="font-size: 14px;">Judson College</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">36756</td>
<td class="gt_row gt_left" style="font-size: 14px;">Bachelor's degree</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">Baptist</td></tr>
    <tr><td class="gt_row gt_right" style="font-size: 14px;">101587</td>
<td class="gt_row gt_left" style="font-size: 14px;">University of West Alabama</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">35470</td>
<td class="gt_row gt_left" style="font-size: 14px;">Master's degree</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">Not applicable</td></tr>
    <tr><td class="gt_row gt_right" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">NA</td></tr>
    <tr><td class="gt_row gt_right" style="font-size: 14px;">101693</td>
<td class="gt_row gt_left" style="font-size: 14px;">University of Mobile</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">36613-2842</td>
<td class="gt_row gt_left" style="font-size: 14px;">Master's degree</td>
<td class="gt_row gt_center" style="font-size: 14px;">NA</td>
<td class="gt_row gt_left" style="font-size: 14px;">Southern Baptist</td></tr>
  </tbody>
  
  
</table></div>
]

.panel[.panel-name[Data setup]

```r
universities &lt;- 
  tibble::tribble(
    ~ID,                          ~Institution, ~year,    ~ZIP.code, ~Highest.degree.offered, ~County.name, ~Religious.affiliation,
    NA,                                    NA,    NA,           NA,                      NA,           NA,                     NA,
    100663L, "University of Alabama at Birmingham",    NA, "35294-0110",       "Doctor's degree",           NA,       "Not applicable",
    100690L,                  "Amridge University",    NA, "36117-3553",       "Doctor's degree",           NA,   "Churches of Christ",
    100706L, "University of Alabama in Huntsville",    NA,      "35899",       "Doctor's degree",           NA,       "Not applicable",
    NA,                                    NA,    NA,           NA,                      NA,           NA,                     NA,
    100751L,           "The University of Alabama",    NA, "35487-0166",       "Doctor's degree",           NA,       "Not applicable",
    NA,                                    NA,    NA,           NA,                      NA,           NA,                     NA,
    NA,                                    NA,    NA,           NA,                      NA,           NA,                     NA,
    101541L,                      "Judson College",    NA,      "36756",     "Bachelor's degree",           NA,              "Baptist",
    101587L,          "University of West Alabama",    NA,      "35470",       "Master's degree",           NA,       "Not applicable",
    NA,                                    NA,    NA,           NA,                      NA,           NA,                     NA,
    101693L,                "University of Mobile",    NA, "36613-2842",       "Master's degree",           NA,     "Southern Baptist"
  )
```
]
]
.small[source: US Integrated Postsecondary Education Data System (IPEDS)]

---


## Identify empty rows with üì¶ .rrured.b[`dplyr`] (and üì¶ .rrured.b[`tibble`])  


```r
universities %&gt;% filter(across(everything(), is.na))
```

```
## # A tibble: 5 x 7
##      ID Institution year  ZIP.code Highest.degree.‚Ä¶ County.name Religious.affil‚Ä¶
##   &lt;int&gt; &lt;chr&gt;       &lt;lgl&gt; &lt;chr&gt;    &lt;chr&gt;            &lt;lgl&gt;       &lt;chr&gt;           
## 1    NA &lt;NA&gt;        NA    &lt;NA&gt;     &lt;NA&gt;             NA          &lt;NA&gt;            
## 2    NA &lt;NA&gt;        NA    &lt;NA&gt;     &lt;NA&gt;             NA          &lt;NA&gt;            
## 3    NA &lt;NA&gt;        NA    &lt;NA&gt;     &lt;NA&gt;             NA          &lt;NA&gt;            
## 4    NA &lt;NA&gt;        NA    &lt;NA&gt;     &lt;NA&gt;             NA          &lt;NA&gt;            
## 5    NA &lt;NA&gt;        NA    &lt;NA&gt;     &lt;NA&gt;             NA          &lt;NA&gt;
```

```r
universities %&gt;% filter(across(everything(), is.na)) %&gt;% nrow()
```

```
## [1] 5
```

---

### Add unique identifier first


```r
universities %&gt;% 
* rowid_to_column() %&gt;%
  filter(across(-rowid, is.na)) 
```

```
## # A tibble: 5 x 8
##   rowid    ID Institution year  ZIP.code Highest.degree.‚Ä¶ County.name
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;       &lt;lgl&gt; &lt;chr&gt;    &lt;chr&gt;            &lt;lgl&gt;      
## 1     1    NA &lt;NA&gt;        NA    &lt;NA&gt;     &lt;NA&gt;             NA         
## 2     5    NA &lt;NA&gt;        NA    &lt;NA&gt;     &lt;NA&gt;             NA         
## 3     7    NA &lt;NA&gt;        NA    &lt;NA&gt;     &lt;NA&gt;             NA         
## 4     8    NA &lt;NA&gt;        NA    &lt;NA&gt;     &lt;NA&gt;             NA         
## 5    11    NA &lt;NA&gt;        NA    &lt;NA&gt;     &lt;NA&gt;             NA         
## # ‚Ä¶ with 1 more variable: Religious.affiliation &lt;chr&gt;
```

---

### Negate the condition .b.purple[(!)] and discard empty rows


```r
universities %&gt;% 
  filter(!across(everything(), is.na))
```

```
## # A tibble: 7 x 7
##       ID Institution year  ZIP.code Highest.degree.‚Ä¶ County.name
##    &lt;int&gt; &lt;chr&gt;       &lt;lgl&gt; &lt;chr&gt;    &lt;chr&gt;            &lt;lgl&gt;      
## 1 100663 University‚Ä¶ NA    35294-0‚Ä¶ Doctor's degree  NA         
## 2 100690 Amridge Un‚Ä¶ NA    36117-3‚Ä¶ Doctor's degree  NA         
## 3 100706 University‚Ä¶ NA    35899    Doctor's degree  NA         
## 4 100751 The Univer‚Ä¶ NA    35487-0‚Ä¶ Doctor's degree  NA         
## 5 101541 Judson Col‚Ä¶ NA    36756    Bachelor's degr‚Ä¶ NA         
## 6 101587 University‚Ä¶ NA    35470    Master's degree  NA         
## 7 101693 University‚Ä¶ NA    36613-2‚Ä¶ Master's degree  NA         
## # ‚Ä¶ with 1 more variable: Religious.affiliation &lt;chr&gt;
```

---

.large[
Discard empty rows with .purple.b[`remove_empty()`]
]  

&gt; `quiet = FALSE` prints a statement about the rows that were removed


```r
universities %&gt;% 
  remove_empty(which = "rows",
               quiet = FALSE) 
```

```
## Removing 5 empty rows of 12 rows total (41.7%).
```

```
## # A tibble: 7 x 7
##       ID Institution year  ZIP.code Highest.degree.‚Ä¶ County.name
##    &lt;int&gt; &lt;chr&gt;       &lt;lgl&gt; &lt;chr&gt;    &lt;chr&gt;            &lt;lgl&gt;      
## 1 100663 University‚Ä¶ NA    35294-0‚Ä¶ Doctor's degree  NA         
## 2 100690 Amridge Un‚Ä¶ NA    36117-3‚Ä¶ Doctor's degree  NA         
## 3 100706 University‚Ä¶ NA    35899    Doctor's degree  NA         
## 4 100751 The Univer‚Ä¶ NA    35487-0‚Ä¶ Doctor's degree  NA         
## 5 101541 Judson Col‚Ä¶ NA    36756    Bachelor's degr‚Ä¶ NA         
## 6 101587 University‚Ä¶ NA    35470    Master's degree  NA         
## 7 101693 University‚Ä¶ NA    36613-2‚Ä¶ Master's degree  NA         
## # ‚Ä¶ with 1 more variable: Religious.affiliation &lt;chr&gt;
```

---

## Empty columns 

.large[
Identify with üì¶ .rrured.b[`dplyr`] and .b.purple[`all_na()`] from üì¶ .rrured.b[`naniar`]  
]


```r
universities %&gt;% 
  select(where(all_na))
```

```
## # A tibble: 12 x 2
##    year  County.name
##    &lt;lgl&gt; &lt;lgl&gt;      
##  1 NA    NA         
##  2 NA    NA         
##  3 NA    NA         
##  4 NA    NA         
##  5 NA    NA         
##  6 NA    NA         
##  7 NA    NA         
##  8 NA    NA         
##  9 NA    NA         
## 10 NA    NA         
## 11 NA    NA         
## 12 NA    NA
```

---

### Identify and get names


```r
universities %&gt;% 
  select(where(all_na)) %&gt;% 
  names()
```

```
## [1] "year"        "County.name"
```

---

### Negate condition for selection, get names



```r
universities %&gt;% 
  select(!where(all_na)) %&gt;% 
  names()
```

```
## [1] "ID"                     "Institution"            "ZIP.code"              
## [4] "Highest.degree.offered" "Religious.affiliation"
```

---

### Discard empty columns with .b.purple[`remove_empty()`] 



```r
universities %&gt;% 
  remove_empty(which= "cols", quiet = FALSE) 
```

```
## Removing 2 empty columns of 7 columns total (Removed: year, County.name).
```

```
## # A tibble: 12 x 5
##        ID Institution            ZIP.code  Highest.degree.of‚Ä¶ Religious.affilia‚Ä¶
##     &lt;int&gt; &lt;chr&gt;                  &lt;chr&gt;     &lt;chr&gt;              &lt;chr&gt;             
##  1     NA &lt;NA&gt;                   &lt;NA&gt;      &lt;NA&gt;               &lt;NA&gt;              
##  2 100663 University of Alabama‚Ä¶ 35294-01‚Ä¶ Doctor's degree    Not applicable    
##  3 100690 Amridge University     36117-35‚Ä¶ Doctor's degree    Churches of Christ
##  4 100706 University of Alabama‚Ä¶ 35899     Doctor's degree    Not applicable    
##  5     NA &lt;NA&gt;                   &lt;NA&gt;      &lt;NA&gt;               &lt;NA&gt;              
##  6 100751 The University of Ala‚Ä¶ 35487-01‚Ä¶ Doctor's degree    Not applicable    
##  7     NA &lt;NA&gt;                   &lt;NA&gt;      &lt;NA&gt;               &lt;NA&gt;              
##  8     NA &lt;NA&gt;                   &lt;NA&gt;      &lt;NA&gt;               &lt;NA&gt;              
##  9 101541 Judson College         36756     Bachelor's degree  Baptist           
## 10 101587 University of West Al‚Ä¶ 35470     Master's degree    Not applicable    
## 11     NA &lt;NA&gt;                   &lt;NA&gt;      &lt;NA&gt;               &lt;NA&gt;              
## 12 101693 University of Mobile   36613-28‚Ä¶ Master's degree    Southern Baptist
```


---

class: my-turn

# My turn

--

- Import the Marine Protected Areas dataset (MPAS-mine.csv)

--

- Identify the empty rows and columns, and create a new object with only the empty rows and columns 

--

- Remove the empty rows and columns 


---
class: inverse

# Your turn

--

- Import the Marine Protected Areas dataset (MPAS-your.csv)

--

- Identify the empty rows and columns, and create a new object with only the empty rows and columns 

--

- Remove the empty rows and columns

--

---

class: center, middle, dk-section-title
background-image:url("images/markus-spiske-4jiR57y3jgY-unsplash.jpg")
background-size: cover
# Parsing Numbers

---
class: middle

.large[
- Vectors must have all their values of the same mode (_character, numeric, logical_)]

--

.large[
- If there is a character string is present in a vector, everything else in the vector will be converted to character strings
]

---

### We cannot perform arithmetic operations on:

--

- Numbers stored as text

--

- Strings with non-digits

--


```r
test_scores &lt;- c(8.8,9,10,7.2,8.4)
class(test_scores)
```

```
## [1] "numeric"
```

```r
class(c(test_scores,"a"))
```

```
## [1] "character"
```

---

## Numbers stored as text


1. .b.purple[`type_convert()`] the whole object (üì¶ .rrured.b[`readr`])

--

2. Coerce one or more variables to `numeric` with üì¶ .rrured.b[`dplyr`]


---

## Strings with non-digits


1. Parse with üì¶ .rrured.b[`readr`]  

2. Clean with .orange.b[regular expressions]


---


.panelset[
.panel[.panel-name[Burger Prices]
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#qevvxmrmcb .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #f4f4f9;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qevvxmrmcb .gt_heading {
  background-color: #f4f4f9;
  text-align: center;
  border-bottom-color: #f4f4f9;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qevvxmrmcb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #f4f4f9;
  border-bottom-width: 0;
}

#qevvxmrmcb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #f4f4f9;
  border-top-width: 0;
}

#qevvxmrmcb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qevvxmrmcb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qevvxmrmcb .gt_col_heading {
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qevvxmrmcb .gt_column_spanner_outer {
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qevvxmrmcb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qevvxmrmcb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qevvxmrmcb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qevvxmrmcb .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#qevvxmrmcb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qevvxmrmcb .gt_from_md > :first-child {
  margin-top: 0;
}

#qevvxmrmcb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qevvxmrmcb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qevvxmrmcb .gt_stub {
  color: #333333;
  background-color: #f4f4f9;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#qevvxmrmcb .gt_summary_row {
  color: #333333;
  background-color: #f4f4f9;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qevvxmrmcb .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#qevvxmrmcb .gt_grand_summary_row {
  color: #333333;
  background-color: #f4f4f9;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qevvxmrmcb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qevvxmrmcb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qevvxmrmcb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qevvxmrmcb .gt_footnotes {
  color: #333333;
  background-color: #f4f4f9;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qevvxmrmcb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#qevvxmrmcb .gt_sourcenotes {
  color: #333333;
  background-color: #f4f4f9;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qevvxmrmcb .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#qevvxmrmcb .gt_left {
  text-align: left;
}

#qevvxmrmcb .gt_center {
  text-align: center;
}

#qevvxmrmcb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qevvxmrmcb .gt_font_normal {
  font-weight: normal;
}

#qevvxmrmcb .gt_font_bold {
  font-weight: bold;
}

#qevvxmrmcb .gt_font_italic {
  font-style: italic;
}

#qevvxmrmcb .gt_super {
  font-size: 65%;
}

#qevvxmrmcb .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="qevvxmrmcb" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 24px;">Rank</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 24px;">Country</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 24px;">Price</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 24px;">Price.ARS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 24px;">Region</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left" style="font-size: 24px;">1</td>
<td class="gt_row gt_left" style="font-size: 24px;">Switzerland</td>
<td class="gt_row gt_left" style="font-size: 24px;">6.8</td>
<td class="gt_row gt_left" style="font-size: 24px;">$544.50</td>
<td class="gt_row gt_left" style="font-size: 24px;">Europe</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 24px;">2</td>
<td class="gt_row gt_left" style="font-size: 24px;">Norway</td>
<td class="gt_row gt_left" style="font-size: 24px;">6.2</td>
<td class="gt_row gt_left" style="font-size: 24px;">496</td>
<td class="gt_row gt_left" style="font-size: 24px;">Europe</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 24px;">3</td>
<td class="gt_row gt_left" style="font-size: 24px;">Sweden</td>
<td class="gt_row gt_left" style="font-size: 24px;">6.1</td>
<td class="gt_row gt_left" style="font-size: 24px;">488</td>
<td class="gt_row gt_left" style="font-size: 24px;">Europe</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 24px;">4</td>
<td class="gt_row gt_left" style="font-size: 24px;">Finland</td>
<td class="gt_row gt_left" style="font-size: 24px;">5.6</td>
<td class="gt_row gt_left" style="font-size: 24px;">448</td>
<td class="gt_row gt_left" style="font-size: 24px;">Europe</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 24px;">5</td>
<td class="gt_row gt_left" style="font-size: 24px;">United States</td>
<td class="gt_row gt_left" style="font-size: 24px;">5.3[1]</td>
<td class="gt_row gt_left" style="font-size: 24px;">$424.50</td>
<td class="gt_row gt_left" style="font-size: 24px;">America</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 24px;">8</td>
<td class="gt_row gt_left" style="font-size: 24px;">Italy</td>
<td class="gt_row gt_left" style="font-size: 24px;">5.1</td>
<td class="gt_row gt_left" style="font-size: 24px;">408</td>
<td class="gt_row gt_left" style="font-size: 24px;">Europe</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 24px;">7</td>
<td class="gt_row gt_left" style="font-size: 24px;">France</td>
<td class="gt_row gt_left" style="font-size: 24px;">5.1</td>
<td class="gt_row gt_left" style="font-size: 24px;">408,50</td>
<td class="gt_row gt_left" style="font-size: 24px;">Europe</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 24px;">6</td>
<td class="gt_row gt_left" style="font-size: 24px;">Canada</td>
<td class="gt_row gt_left" style="font-size: 24px;">5.3</td>
<td class="gt_row gt_left" style="font-size: 24px;">424</td>
<td class="gt_row gt_left" style="font-size: 24px;">America</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 24px;">9</td>
<td class="gt_row gt_left" style="font-size: 24px;">Brazil</td>
<td class="gt_row gt_left" style="font-size: 24px;">5.1*</td>
<td class="gt_row gt_left" style="font-size: 24px;">408</td>
<td class="gt_row gt_left" style="font-size: 24px;">America</td></tr>
  </tbody>
  
  
</table></div>
]

.panel[.panel-name[Data setup]

```r
burger_prices &lt;- 
  tibble::tribble(
    ~Rank,        ~Country,   ~Price, ~Price.ARS,   ~Region,
    "1",   "Switzerland",    "6.8",  "$544.50",  "Europe",
    "2",        "Norway",    "6.2",      "496",  "Europe",
    "3",        "Sweden",    "6.1",      "488",  "Europe",
    "4",       "Finland",    "5.6",      "448",  "Europe",
    "5", "United States", "5.3[1]",  "$424.50", "America",
    "8",         "Italy",    "5.1",      "408",  "Europe",
    "7",        "France",    "5.1",   "408,50",  "Europe",
    "6",        "Canada",    "5.3",      "424", "America",
    "9",        "Brazil",   "5.1*",      "408", "America"
  )
```
]
]

---

## Numbers stored as text  

Parse all columns


```r
burger_prices %&gt;% 
  type_convert()
```

```
## # A tibble: 9 x 5
##    Rank Country       Price  Price.ARS Region 
##   &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;  
## 1     1 Switzerland   6.8    $544.50   Europe 
## 2     2 Norway        6.2    496       Europe 
## 3     3 Sweden        6.1    488       Europe 
## 4     4 Finland       5.6    448       Europe 
## 5     5 United States 5.3[1] $424.50   America
## 6     8 Italy         5.1    408       Europe 
## 7     7 France        5.1    408,50    Europe 
## 8     6 Canada        5.3    424       America
## 9     9 Brazil        5.1*   408       America
```

---

## Numbers stored as text  


```r
burger_prices 
```

```
## # A tibble: 9 x 5
##   Rank  Country       Price  Price.ARS Region 
##   &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;  
## 1 1     Switzerland   6.8    $544.50   Europe 
## 2 2     Norway        6.2    496       Europe 
## 3 3     Sweden        6.1    488       Europe 
## 4 4     Finland       5.6    448       Europe 
## 5 5     United States 5.3[1] $424.50   America
## 6 8     Italy         5.1    408       Europe 
## 7 7     France        5.1    408,50    Europe 
## 8 6     Canada        5.3    424       America
## 9 9     Brazil        5.1*   408       America
```

---

## Numbers stored as text  

Coerce variables to `numeric`


```r
burger_prices %&gt;% 
  mutate(Rank = as.numeric(Rank))
```

```
## # A tibble: 9 x 5
##    Rank Country       Price  Price.ARS Region 
##   &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;  
## 1     1 Switzerland   6.8    $544.50   Europe 
## 2     2 Norway        6.2    496       Europe 
## 3     3 Sweden        6.1    488       Europe 
## 4     4 Finland       5.6    448       Europe 
## 5     5 United States 5.3[1] $424.50   America
## 6     8 Italy         5.1    408       Europe 
## 7     7 France        5.1    408,50    Europe 
## 8     6 Canada        5.3    424       America
## 9     9 Brazil        5.1*   408       America
```

---

## Strings with non-digits

Parse with üì¶ .rrured.b[`readr`] (‚ö† watch out for inconsistent decimals)


```r
burger_prices %&gt;% 
  mutate(across(c(Rank, Price, Price.ARS), parse_number))
```

```
## # A tibble: 9 x 5
##    Rank Country       Price Price.ARS Region 
##   &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  
## 1     1 Switzerland     6.8      544. Europe 
## 2     2 Norway          6.2      496  Europe 
## 3     3 Sweden          6.1      488  Europe 
## 4     4 Finland         5.6      448  Europe 
## 5     5 United States   5.3      424. America
## 6     8 Italy           5.1      408  Europe 
## 7     7 France          5.1    40850  Europe 
## 8     6 Canada          5.3      424  America
## 9     9 Brazil          5.1      408  America
```

---

## Strings with non-digits

.large[
Clean with .orange.b[regular expressions] then .b.purple[`type_convert()`]
]





```r
burger_prices %&gt;%
  mutate(across(c(Rank, Price, Price.ARS), str_remove_all, "\\[.+\\]|\\(.+\\)")) %&gt;%
  mutate(across(c(Rank, Price, Price.ARS), str_remove_all, "[^0-9.,]")) %&gt;%
  mutate(Price.ARS = str_replace(Price.ARS, ",", ".")) %&gt;% 
  type_convert()
```

---




```r
burger_prices %&gt;%
  mutate(across(c(Rank, Price, Price.ARS), str_remove_all, "\\[.+\\]|\\(.+\\)")) %&gt;%
  mutate(across(c(Rank, Price, Price.ARS), str_remove_all, "[^0-9.,]")) %&gt;%
  mutate(Price.ARS = str_replace(Price.ARS, ",", ".")) %&gt;% 
  type_convert()
```

```
## # A tibble: 9 x 5
##    Rank Country       Price Price.ARS Region 
##   &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  
## 1     1 Switzerland   6.8       544.5 Europe 
## 2     2 Norway        6.2       496   Europe 
## 3     3 Sweden        6.1       488   Europe 
## 4     4 Finland       5.6       448   Europe 
## 5     5 United States 5.3       424.5 America
## 6     8 Italy         5.100     408   Europe 
## 7     7 France        5.100     408.5 Europe 
## 8     6 Canada        5.3       424   America
## 9     9 Brazil        5.100     408   America
```

---
class: my-turn
# My turn

--
.large[
- Import the Marine Protected Areas dataset (MPAS-mine.csv)
]

--

.large[
- Make the columns that hold the MPA extent into usable numeric variables
]

---
class: inverse
# Your turn

--

.large[
- Import the Marine Protected Areas dataset (MPAS-mine.csv)
]

--

.large[
- Subset to keep only the MPA names and columns with extent data
]

--

.large[
- Make the columns that hold the MPA extent into usable numeric variables (Watch out for the decimals!)]


---

class: center, middle, dk-section-title
background-image:url("images/ryan-quintal-US9Tc9pKNBU-unsplash.jpg")
background-size: cover


# Putting Everything Together

---

## Demonstration

.large[Watch me load and wrangle the messy Age of Empires units dataset into a usable, tidy object]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
